parameters:
  - name: subscriptionName
    type: string
  - name: apimName
    type: string
  - name: resourceGroupName
    type: string

steps:
  - template: templates\ApiManagement\check-soft-deleted.yaml@azTemplates
    parameters: 
      subscriptionName: ${{ parameters.subscriptionName }}
      apimName: ${{ parameters.apimName }}
      resourceGroupName: ${{ parameters.resourceGroupName }}
      variableName: available
      taskName: apim
  
  - ${{ if eq(variables['apim.available'], 'false') }}:
    - template: templates\ApiManagement\purge.yaml@azTemplates
      parameters: 
        subscriptionName: ${{ parameters.subscriptionName }}
        apimName: ${{ parameters.apimName }}
        resourceGroupName: ${{ parameters.resourceGroupName }}