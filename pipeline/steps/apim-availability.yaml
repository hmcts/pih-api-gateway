parameters:
  - name: subscriptionName
    type: string
  - name: apimName
    type: string
  - name: resourceGroupName
    type: string

steps:
  - template: templates\Azure\Common\check-soft-deleted.yaml@azTemplates
    parameters: 
      subscriptionName: ${{ parameters.subscriptionName }}
      resourceName: ${{ parameters.apimName }}
      resourceLocation: $(location)
      variableName: available
      taskName: apim
  
  - bash: |
      echo "feedback: $feedback"
    env:
      feedback: $(apim.available)

  - ${{ if eq('$(apim.available)', 'false') }}:
    - template: templates\Azure\ApiManagement\purge.yaml@azTemplates
      parameters: 
        subscriptionName: ${{ parameters.subscriptionName }}
        apimName: ${{ parameters.apimName }}
        apimLocation: $(location)